<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UF0929 Gestión de pedidos y stocks</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #F0F0F0;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }

        .contenedor-principal {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            padding: 20px;
            z-index: 1;
        }

        section.contenedor-test, footer.rectangulo-resumen {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 800px;
            max-width: 800px;
            text-align: center;
        }

        .titulo-test {
            font-size: 24px;
            font-weight: bold;
            color: #6c757d;
            margin: 0 0 20px 0;
            text-align: center;
        }

        .pregunta {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            text-align: left;
        }
        .opciones-contenedor {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }
        .opcion {
            background-color: #e9ecef;
            border: 2px solid #e9ecef;
            color: #495057;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s, border-color 0.2s;
            text-align: left;
        }
        .opcion:hover {
            background-color: #dee2e6;
        }
        .opcion.seleccionada {
            background-color: #cce5ff;
            border-color: #cce5ff;
            color: #004085;
        }
        .opcion.correcta {
            background-color: #85d192;
            border-color: #85d192;
            color: #155724;
            cursor: default;
        }
        .opcion.incorrecta {
            background-color: #f0a1a8;
            border-color: #f0a1a8;
            color: #721c24;
            cursor: default;
        }
        .opcion.correcta:hover, .opcion.incorrecta:hover {
            background-color: #85d192;
            color: #155724;
            border-color: #85d192;
        }
        .opcion.incorrecta:hover {
            background-color: #f0a1a8;
            color: #721c24;
            border-color: #f0a1a8;
        }
        .navegacion-btn-contenedor {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            width: 100%;
        }

        .comprobar-btn, #finalizar-btn {
            background-color: #cce5ff;
            color: #004085;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .comprobar-btn:hover, #finalizar-btn:hover {
            background-color: #b3d7ff;
        }
        .hidden {
            display: none;
        }

        .navegacion-btn {
            background-color: #E0E0E0;
            color: #555;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .navegacion-btn:hover {
            background-color: #CFCFCF;
        }
        .navegacion-btn:disabled {
            background-color: #f1f1f1;
            color: #aaa;
            cursor: not-allowed;
            box-shadow: none;
        }
        footer.rectangulo-resumen {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 800px;
            margin-top: 20px;
            overflow-y: auto;
        }
        .indices-contenedor {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .indice-pregunta {
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            background-color: #e9ecef;
            cursor: pointer;
            transition: background-color 0.2s;
            color: #495057;
            font-weight: bold;
            font-size: 14px;
        }
        .indice-pregunta.activa {
            background-color: #cce5ff;
            color: #004085;
            border: none;
        }
        .indice-pregunta:hover {
            background-color: #dee2e6;
        }
        .indice-pregunta.correcta {
            background-color: #85d192;
            color: #155724;
        }
        .indice-pregunta.incorrecta {
            background-color: #f0a1a8;
            color: #495057;
        }

        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .custom-modal {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .custom-modal h3 {
            margin-top: 0;
            color: #333;
        }

        .custom-modal button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        .resultados-finales-container {
            text-align: center;
        }
        .resultados-finales-texto {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .resultados-finales-correctas {
            color: #155724;
            font-weight: bold;
        }
        .resultados-finales-incorrectas {
            color: #721c24;
            font-weight: bold;
        }
        .boton-volver-menu {
            background-color: #cce5ff;
            color: #004085;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .boton-volver-menu:hover {
            background-color: #b3d7ff;
        }
        
        @media (max-width: 800px) {
            section.contenedor-test, footer.rectangulo-resumen {
                width: 95%;
                padding: 15px;
            }
            .opcion {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="contenedor-principal">
        <h1 class="titulo-test">UF0929 Gestión de pedidos y stocks</h1>
        <section class="contenedor-test">
            <article id="contenido-pregunta">
                <div class="pregunta" id="pregunta-texto"></div>
                <div class="opciones-contenedor" id="opciones-contenedor"></div>
                <div class="navegacion-btn-contenedor">
                    <button id="volver-btn" class="navegacion-btn">Anterior</button>
                    <button id="comprobar-btn" class="comprobar-btn">Comprobar</button>
                    <button id="siguiente-btn" class="navegacion-btn">Siguiente</button>
                </div>
            </article>
            <div id="resultados-finales" class="hidden resultados-finales-container">
                <h2>Resultados Finales</h2>
                <div id="resultados-texto" class="resultados-finales-texto"></div>
                <button id="volver-menu-btn" class="boton-volver-menu">Volver al menú principal</button>
            </div>
        </section>
        <footer class="rectangulo-resumen" id="rectangulo-resumen">
            <div class="indices-contenedor" id="indices-contenedor"></div>
            <button id="finalizar-btn" class="comprobar-btn" style="width: 100%; margin-top: 20px;">Finalizar Test</button>
        </footer>
    </div>

    <div id="custom-modal-overlay" class="custom-modal-overlay hidden">
        <div class="custom-modal">
            <p id="custom-modal-message"></p>
            <button id="custom-modal-ok">Aceptar</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let preguntas = [
  {
    "question": "Las funciones de aprovisionamiento en logística hacen referencia a:",
    "options": [
      "a) La manufacturación descentralizada de los centros de producción.",
      "b) La preparación de los pedidos para su distribución.",
      "c) Diversas tareas como la gestión del stock, la recepción de bienes o la sincronización de las diversas ubicaciones.",
      "d) La atención a las devoluciones en el servicio postventa."
    ],
    "correct": 2
  },
  {
    "question": "¿Cuál de los siguientes no es un tipo de almacén según su nivel operativo?",
    "options": [
      "a) Almacén en bloque.",
      "b) Almacén compacto.",
      "c) Almacén dinámico.",
      "d) Almacén prioritario."
    ],
    "correct": 3
  },
  {
    "question": "Los tipos de cross docking son:",
    "options": [
      "a) Cross docking predistribuido.",
      "b) Cross docking consolidado.",
      "c) Cross docking predistribuido y consolidado.",
      "d) Cross docking temporal y manufacturado."
    ],
    "correct": 2
  },
  {
    "question": "La gestión de almacenes es el proceso de la función logística que trata:",
    "options": [
      "a) Recepción y movimiento de cualquier producto dentro del almacén.",
      "b) Almacenamiento y movimiento de cualquier producto dentro del almacén.",
      "c) Recepción y almacenamiento de cualquier producto dentro del almacén.",
      "d) Recepción, almacenamiento y movimiento de cualquier producto dentro del almacén."
    ],
    "correct": 3
  },
  {
    "question": "No forma parte del proceso de recepción de las mercancías:",
    "options": [
      "a) Recepción detallada.",
      "b) Recepción a ciegas.",
      "c) Recepción semiconvencional.",
      "d) Recepción convencional."
    ],
    "correct": 2
  },
  {
    "question": "No es un tipo de flujo interno de mercancías:",
    "options": [
      "a) Simple.",
      "b) Normalizado.",
      "c) Medio.",
      "d) Flujo complejo."
    ],
    "correct": 1
  },
  {
    "question": "Las transpaletas:",
    "options": [
      "a) Trata de uno de los dispositivos mecánicos más importantes y más utilizados en los almacenes para el transporte, carga y descarga de mercancías en el almacén.",
      "b) Trata de uno de los dispositivos mecánicos menos importantes y menos utilizados en los almacenes para el transporte, carga y descarga de mercancías en el almacén.",
      "c) Trata de uno de los dispositivos mecánicos más importantes, aunque es muy poco usado debido a su alto coste.",
      "d) Trata de uno de los dispositivos mecánicos más importantes que se emplean exclusivamente en los procesos de descarga."
    ],
    "correct": 0
  },
  {
    "question": "Las máquinas enfardadoras:",
    "options": [
      "a) Imprimen y pegan etiquetas para el transporte de mercancías.",
      "b) Son máquinas utilizadas para proteger la carga, asegurando su estabilidad y garantizando la mejor presentación de esta.",
      "c) Imprimen una etiqueta a la vez que envuelven la carga.",
      "d) Solo pueden usarse con pequeños bultos."
    ],
    "correct": 1
  },
  {
    "question": "Las reposiciones automáticas por mínimos:",
    "options": [
      "a) Trata de un proceso que se realiza de forma periódica, posibilita el mantenimiento de existencias en el área de preparación en las cantidades adecuadas, según la capacidad y los mínimos huecos para picking que tienen asociadas las mercancías.",
      "b) Trata de un proceso que se realiza constantemente, posibilita el mantenimiento de existencias en el área de preparación en las cantidades aproximadas, según la capacidad y los mínimos huecos para picking que tienen asociadas las mercancías.",
      "c) Trata de un proceso que se realiza de forma periódica, posibilita el mantenimiento de existencias en el área de recogida en las cantidades adecuadas, según la capacidad del vehículo y los máximos huecos para picking que tienen asociadas las mercancías.",
      "d) Trata de un proceso que se realiza diariamente, posibilita el mantenimiento de existencias en el área de preparación en las cantidades adecuadas, según la capacidad y los máximos huecos para almacenamiento que tienen asociadas las mercancías."
    ],
    "correct": 0
  },
  {
    "question": "EI ROI:",
    "options": [
      "a) Es un porcentaje que expresa los beneficios obtenidos de una inversión en relación con los costes que esta conlleva para la empresa.",
      "b) Es un porcentaje que expresa las pérdidas de una inversión en relación con los costes que esta conlleva para la empresa.",
      "c) Es un valor absoluto que expresa las pérdidas de una inversión en relación con los costes que esta conlleva para la empresa.",
      "d) Es un valor absoluto que expresa las ganancias obtenidas de una inversión en relación con los ingresos que esta aporta a la empresa."
    ],
    "correct": 0
  },
  {
    "question": "¿Cuál de los siguientes no es un objetivo de la preparación del pedido?",
    "options": [
      "a) Optimizar las taras de recogida de artículos.",
      "b) Agilizar el proceso de reparación.",
      "c) Optimizar la rotación de inventario.",
      "d) No llevar el control de la mercancía expedida."
    ],
    "correct": 3
  },
  {
    "question": "¿Cuál no es un dato que forma los pedidos?",
    "options": [
      "a) Fecha de comienzo estimada.",
      "b) Código del pedido.",
      "c) Importe total del pedido.",
      "d) Nombre del operario."
    ],
    "correct": 3
  },
  {
    "question": "¿Cuál de estos factores no sirve para mejorar el rendimiento de la preparación de pedidos?",
    "options": [
      "a) Tener un Sistema de Gestión de Almacén (SGA) que sirve para preparar el pedido en tiempo real.",
      "b) Disponer de sistemas adecuados de estanterías.",
      "c) Optimizar la accesibilidad de los artículos.",
      "d) Asegurar calidad, no mezclar productos de distinta naturaleza."
    ],
    "correct": 1
  },
  {
    "question": "¿En qué punto pueden ayudar las tecnologías para mejorar la cadena de suministro?",
    "options": [
      "a) En las negociaciones entre el proveedor y el cliente.",
      "b) En las relaciones entre los operarios.",
      "c) En la calidad de los materiales.",
      "d) En la caducidad del producto."
    ],
    "correct": 0
  },
  {
    "question": "¿Cuál una de las soluciones posibles para evitar la ineficiencia en la carga y descarga de camiones?",
    "options": [
      "a) Hacer la carga y descarga con más rapidez.",
      "b) Pactar los horarios para cargar y descargar.",
      "c) Que vayan dos transportistas en vez de uno.",
      "d) Evitar fijar tiempo para la espera."
    ],
    "correct": 1
  },
  {
    "question": "¿Cuál de estos sistemas no mejoran la ergonomía?",
    "options": [
      "a) Transpaletas y recogepedidos con plataforma que se eleva.",
      "b) Zonas iluminadas.",
      "c) Cintas transportadoras o rodillos.",
      "d) Nuevos uniformes para los operarios."
    ],
    "correct": 3
  },
  {
    "question": "¿Cuál no es una ventaja del sistema producto a operario?",
    "options": [
      "a) Se eliminan los recorridos de los operarios.",
      "b) Se optimizan los espacios en el almacén.",
      "c) Se pueden cargar mercancías de mayor tamaño.",
      "d) Existe más seguridad para la mercancía ante hurtos y robos."
    ],
    "correct": 2
  },
  {
    "question": "¿Cuál no es un tipo de estanterías ligeras?",
    "options": [
      "a) Estanterías de carga.",
      "b) Estanterías para picking.",
      "c) Estanterías sin tornillos.",
      "d) Estanterías de ángulo ranurado."
    ],
    "correct": 0
  },
  {
    "question": "¿Cuál es el principal objetivo del etiquetado?",
    "options": [
      "a) Dar información sobre el contenido de las mercancías a los transportistas y clientes finales.",
      "b) Saber el operario las mercancías.",
      "c) Llevar una buena organización de los productos.",
      "d) Gestionar más rápidamente los pedidos."
    ],
    "correct": 0
  },
  {
    "question": "El inventario consiste en una serie:",
    "options": [
      "a) De registros documentados de manera ordenada y precisa, de los materiales o artículos pertenecientes a una organización.",
      "b) De anotaciones simples de manera ordenada, de los materiales o artículos pertenecientes a una organización.",
      "c) De registros documentados de cualquier manera, de los materiales o artículos pertenecientes a una organización.",
      "d) De registros documentados de manera ordenada y precisa, de los palés de la empresa."
    ],
    "correct": 0
  },
  {
    "question": "¿Para qué va a servir el inventario físico?",
    "options": [
      "a) Para tener un mayor control sobre el stock.",
      "b) Para tener un menor control sobre el stock.",
      "c) Para tener mayor control sobre los medios de manutención necesarios.",
      "d) Para tener un mayor control sobre las tareas y las horas asignadas a los operarios del almacén."
    ],
    "correct": 0
  },
  {
    "question": "El inventario selectivo:",
    "options": [
      "a) Implica a todos los artículos de la empresa.",
      "b) Se efectúa al menos una vez al año ya que es obligatorio por ley.",
      "c) Se realiza solo en determinadas épocas del año.",
      "d) Implica solo a determinadas referencias."
    ],
    "correct": 3
  },
  {
    "question": "Es una situación de almacenamiento válida que entra en conflicto:",
    "options": [
      "a) Espacio Vs. Accesibilidad.",
      "b) Personal Vs. Protección ante incendios del almacén.",
      "c) Uso del espacio del almacén vs. la prevención de riesgos laborales.",
      "d) El número de operarios vs. El número de transportistas esperando."
    ],
    "correct": 0
  },
  {
    "question": "El sistema de almacenamiento basado en los recuerdos de los operarios sobre la ubicación de las mercancías recibe el nombre de:",
    "options": [
      "a) Sistema de memoria.",
      "b) Sistema de localización fija.",
      "c) Sistema de zonificación.",
      "d) Sistema de localización aleatoria."
    ],
    "correct": 0
  },
  {
    "question": "El intercambio de datos (EDI, Electronic Data Interchange) consiste:",
    "options": [
      "a) En el intercambio de datos en papel de manera homogénea en los diferentes archivadores utilizados en la empresa.",
      "b) En el intercambio de datos de forma electrónica de manera heterogénea en los diferentes equipos informáticos utilizados en la empresa.",
      "c) En el intercambio de datos de forma electrónica de manera homogénea en los diferentes equipos informáticos utilizados en la empresa.",
      "d) En guardado de datos de forma manual de manera heterogénea en los diferentes archivadores utilizados en la empresa."
    ],
    "correct": 2
  },
  {
    "question": "La confusión entre unidades y cargas completa es un tipo de error:",
    "options": [
      "a) Por mala gestión del tiempo.",
      "b) Por volumen de trabajo",
      "c) Por precisión al desarrollar la tarea.",
      "d) Por desconocimiento de la tarea."
    ],
    "correct": 3
  },
  {
    "question": "Las diferencias y los errores de inventario se pueden producir principalmente por:",
    "options": [
      "a) Tener el inventario actualizado.",
      "b) Productos que salen de los almacenes sin que quede registrada su salida.",
      "c) Tener muy claros los productos.",
      "d) Operarios motivados por su trabajo."
    ],
    "correct": 1
  },
  {
    "question": "Tres pasos forman el plan ante desastres o emergencias y continuidad empresaria:",
    "options": [
      "a) Preparación, ejecución y validez.",
      "b) Estudio, práctica y recuperación.",
      "c) Preparación, ejecución y recuperación.",
      "d) Preparación, práctica y validez."
    ],
    "correct": 2
  },
  {
    "question": "Son métodos de realización de inventarios:",
    "options": [
      "a) Anual, mensual, trimestral.",
      "b) Fijo y por niveles.",
      "c) Por familias.",
      "d) Anuales y fijos."
    ],
    "correct": 2
  },
  {
    "question": "¿Cuál de las siguientes no es una ventaja de la implantación del ERP en la empresa?",
    "options": [
      "a) Alto poder de control sobre la organización.",
      "b) Aumenta el tiempo de análisis de la información.",
      "c) Optimización de los tiempos de producción y entregas.",
      "d) Disminución de costes."
    ],
    "correct": 1
  },
  {
    "question": "¿Cuál de los siguientes no es uno de los módulos que integran los ERP?",
    "options": [
      "a) Gestión de almacén.",
      "b) Facturación.",
      "c) Gestión de software.",
      "d) Gestión de ventas."
    ],
    "correct": 2
  },
  {
    "question": "¿De cuál de los siguientes procesos no proporciona informes el SGA?",
    "options": [
      "a) Productividad del personal del almacén.",
      "b) Utilización del espacio.",
      "c) Envíos a tiempo.",
      "d) Control de calidad de los transportistas."
    ],
    "correct": 3
  },
  {
    "question": "¿Cuál de las siguientes no es una tecnología disponible para la preparación de pedidos?",
    "options": [
      "a) picking to light.",
      "b) El picking by tag.",
      "c) El picking by vision.",
      "d) Las etiquetas RFID."
    ],
    "correct": 1
  },
  {
    "question": "¿Cuál de las siguientes no es una solución operativa del picking to light?",
    "options": [
      "a) Realización y control de ventas.",
      "b) Control de roturas y desviaciones de stock.",
      "c) Reposiciones y trasbordos.",
      "d) Preparación de pedidos individuales o en grupo."
    ],
    "correct": 0
  },
  {
    "question": "¿Cuál de las siguientes es un tipo de tecnología por voz?",
    "options": [
      "a) De tecnología independiente.",
      "b) De tecnología analógica.",
      "c) De tecnología dependiente del SGA.",
      "d) De tecnología por radiofrecuencia."
    ],
    "correct": 0
  },
  {
    "question": "¿Cuál de los siguientes es un tipo de extracción en almacenes automáticos?",
    "options": [
      "a) Preparador en puesto fijo seleccionando equipos.",
      "b) Preparador en puesto fijo seleccionando artículos.",
      "c) Preparador en puesto móvil seleccionando equipos.",
      "d) Preparador en puesto fijo seleccionando picks."
    ],
    "correct": 0
  },
  {
    "question": "¿Cuál de los siguientes no es un sistema de guiado para AGV's?",
    "options": [
      "a) Filoguiado.",
      "b) Elementos ópticos.",
      "c) Automatismos de referencia.",
      "d) Láser."
    ],
    "correct": 2
  },
  {
    "question": "¿Cuál de las siguientes no es una ventaja del RFID?",
    "options": [
      "a) Disminuir notablemente los tiempos de lectura.",
      "b) Aumenta la capacidad de rotación de artículos.",
      "c) Posibilita la multilectura de artículos.",
      "d) Anula la restricción del campo visual necesario entre el código y el dispositivo lector."
    ],
    "correct": 1
  },
  {
    "question": "¿En qué método de gestión de stocks se tiene en cuenta el consumo medio real de un producto evaluando su historial reciente?",
    "options": [
      "a) Del punto de pedido.",
      "b) Del período de pedido.",
      "c) Probabilístico.",
      "d) Determinista."
    ],
    "correct": 2
  },
  {
    "question": "¿Cuál de los siguientes es uno de los errores más comunes durante el proceso de descarga no forma parte del proceso de recepción de las mercancías?",
    "options": [
      "a) Recepción detallada.",
      "b) Recepción a ciegas.",
      "c) Recepción convencional.",
      "d) Recepción semiconvencional."
    ],
    "correct": 3
  },
  {
    "question": "¿Cuál de estas no es una función del SGA?",
    "options": [
      "a) Controlar la mercancía almacenada.",
      "b) Controlar el trabajo que se hace en el almacén.",
      "c) Toda la gestión la va a desarrollar a tiempo real.",
      "d) Se encarga de planificar, asignar y también controlar el trabajo de todos los recursos que existen en el almacén."
    ],
    "correct": 1
  }
];
            let DOM = {};

            const estado = {
                preguntaActual: 0,
                respuestasCorrectas: 0,
                respuestasIncorrectas: 0,
                totalPreguntas: preguntas.length
            };

            let botonesOpciones;
            let indicesPreguntas;

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function toggleClasses(element, addClass, removeClasses) {
                if (removeClasses && removeClasses.length > 0) {
                    removeClasses.forEach(cls => element.classList.remove(cls));
                }
                if (addClass) {
                    element.classList.add(addClass);
                }
            }

            function mostrarModal(message) {
                DOM.modalMessage.textContent = message;
                DOM.modalOverlay.classList.remove('hidden');
            }

            function ocultarModal() {
                DOM.modalOverlay.classList.add('hidden');
            }

            function marcarRespuesta(index) {
                const pregunta = preguntas[index];

                const botonCorrecto = botonesOpciones[pregunta.correct];
                const indiceCorrecto = indicesPreguntas[index];

                toggleClasses(indiceCorrecto, null, ['correcta', 'incorrecta']);

                if (pregunta.respuestaUsuario !== null) {
                    toggleClasses(botonCorrecto, 'correcta');

                    if (pregunta.esCorrecta) {
                        toggleClasses(indiceCorrecto, 'correcta');
                    } else {
                        const botonSeleccionado = botonesOpciones[pregunta.respuestaUsuario];
                        toggleClasses(botonSeleccionado, 'incorrecta');
                        toggleClasses(indiceCorrecto, 'incorrecta');
                    }
                }
            }

            function mostrarPregunta() {
                const { preguntaActual, totalPreguntas } = estado;
                DOM.resultadosFinales.classList.add('hidden');
                DOM.contenidoPregunta.classList.remove('hidden');
                DOM.rectanguloResumen.classList.remove('hidden');
                DOM.finalizarBtn.textContent = 'Finalizar Test';

                const pregunta = preguntas[preguntaActual];
                const cleanedQuestion = pregunta.question.replace(/^\s*(\d+\.\s*)+/, '');
                DOM.preguntaTexto.textContent = `${preguntaActual + 1}. ${cleanedQuestion}`;

                botonesOpciones.forEach((boton, index) => {
                    toggleClasses(boton, null, ['seleccionada', 'correcta', 'incorrecta']);
                    boton.textContent = pregunta.options[index];
                    boton.disabled = pregunta.comprobada;
                });

                if (pregunta.respuestaUsuario !== null) {
                    toggleClasses(botonesOpciones[pregunta.respuestaUsuario], 'seleccionada');
                    if (pregunta.comprobada) {
                        marcarRespuesta(preguntaActual);
                    }
                }

                if (indicesPreguntas) {
                    indicesPreguntas.forEach(indice => indice.classList.remove('activa'));
                    indicesPreguntas[preguntaActual].classList.add('activa');
                }

                DOM.comprobarBtn.classList.toggle('hidden', pregunta.comprobada);
                actualizarEstadoBotones();
            }

            function manejarSeleccion(event) {
                const boton = event.target.closest('.opcion');
                if (boton) {
                    const pregunta = preguntas[estado.preguntaActual];
                    if (!pregunta.comprobada) {
                        botonesOpciones.forEach(b => toggleClasses(b, null, ['seleccionada']));
                        toggleClasses(boton, 'seleccionada');
                    }
                }
            }

            function comprobarRespuesta() {
                const respuestaSeleccionadaActual = DOM.opcionesContenedor.querySelector('.opcion.seleccionada');
                if (!respuestaSeleccionadaActual) {
                    mostrarModal('Por favor, selecciona una respuesta antes de comprobar.');
                    return;
                }
                const { preguntaActual } = estado;
                const pregunta = preguntas[preguntaActual];
                const respuestaIndex = parseInt(respuestaSeleccionadaActual.dataset.index);

                pregunta.respuestaUsuario = respuestaIndex;
                pregunta.comprobada = true;
                pregunta.esCorrecta = (respuestaIndex === pregunta.correct);

                if (pregunta.esCorrecta) {
                    estado.respuestasCorrectas++;
                } else {
                    estado.respuestasIncorrectas++;
                }

                marcarRespuesta(preguntaActual);
                actualizarResumen();

                botonesOpciones.forEach(boton => boton.disabled = true);
                DOM.comprobarBtn.classList.add('hidden');
            }

            function actualizarEstadoBotones() {
                const { preguntaActual, totalPreguntas } = estado;
                const esUltimaPregunta = preguntaActual === totalPreguntas - 1;
                DOM.volverBtn.disabled = preguntaActual === 0;
                DOM.siguienteBtn.textContent = esUltimaPregunta ? 'Terminar' : 'Siguiente';
            }

            function siguientePregunta() {
                const { preguntaActual, totalPreguntas } = estado;
                if (preguntaActual < totalPreguntas - 1) {
                    estado.preguntaActual++;
                    mostrarPregunta();
                } else {
                    mostrarResultados();
                }
            }

            function volverPregunta() {
                const { preguntaActual } = estado;
                if (preguntaActual > 0) {
                    estado.preguntaActual--;
                    mostrarPregunta();
                }
            }

            function mostrarResultados() {
                const { respuestasCorrectas, respuestasIncorrectas } = estado;
                DOM.contenidoPregunta.classList.add('hidden');
                DOM.resultadosFinales.classList.remove('hidden');

                const correctasSpan = `<span class="resultados-finales-correctas">Correctas: ${respuestasCorrectas}</span>`;
                const incorrectasSpan = `<span class="resultados-finales-incorrectas">Incorrectas: ${respuestasIncorrectas}</span>`;
                DOM.resultadosTexto.innerHTML = `${correctasSpan} | ${incorrectasSpan}`;

                DOM.finalizarBtn.textContent = 'Volver al Test';
                DOM.rectanguloResumen.style.marginTop = '20px';
            }

            function crearIndices() {
                DOM.indicesContenedor.innerHTML = Array.from(
                    {length: estado.totalPreguntas},
                    (_, i) => `<div class="indice-pregunta" data-index="${i}">${i+1}</div>`
                ).join('');
                indicesPreguntas = DOM.indicesContenedor.querySelectorAll('.indice-pregunta');
            }

            function manejarClickIndice(event) {
                const indice = event.target.closest('.indice-pregunta');
                if (indice) {
                    estado.preguntaActual = parseInt(indice.dataset.index);
                    mostrarPregunta();
                }
            }

            function actualizarResumen() {
                indicesPreguntas.forEach((indice, index) => {
                    toggleClasses(indice, null, ['correcta', 'incorrecta']);
                    const pregunta = preguntas[index];
                    if (pregunta.comprobada) {
                        if (pregunta.esCorrecta) {
                            toggleClasses(indice, 'correcta');
                        } else {
                            toggleClasses(indice, 'incorrecta');
                        }
                    }
                });
            }

            function toggleFinalizarTest() {
                if (DOM.resultadosFinales.classList.contains('hidden')) {
                    mostrarResultados();
                } else {
                    mostrarPregunta();
                }
            }
            
            function volverAlMenuPrincipal() {
                window.location.href = '../index.html';
            }

            function cacheElements() {
                return {
                    preguntaTexto: document.getElementById('pregunta-texto'),
                    opcionesContenedor: document.getElementById('opciones-contenedor'),
                    siguienteBtn: document.getElementById('siguiente-btn'),
                    volverBtn: document.getElementById('volver-btn'),
                    comprobarBtn: document.getElementById('comprobar-btn'),
                    indicesContenedor: document.getElementById('indices-contenedor'),
                    contenedorTest: document.querySelector('section.contenedor-test'),
                    rectanguloResumen: document.querySelector('footer.rectangulo-resumen'),
                    modalOverlay: document.getElementById('custom-modal-overlay'),
                    modalMessage: document.getElementById('custom-modal-message'),
                    modalOkBtn: document.getElementById('custom-modal-ok'),
                    contenidoPregunta: document.getElementById('contenido-pregunta'),
                    resultadosFinales: document.getElementById('resultados-finales'),
                    resultadosTexto: document.getElementById('resultados-texto'),
                    finalizarBtn: document.getElementById('finalizar-btn'),
                    volverMenuBtn: document.getElementById('volver-menu-btn')
                };
            }

            function initData() {
                const labels = ['a) ', 'b) ', 'c) ', 'd) '];
                preguntas.forEach(p => {
                    if (p.options && p.options.length > 0 && typeof p.correct === 'number' && p.correct < p.options.length) {
                        const correctAnswerText = p.options[p.correct].substring(3).trim();
                        let answerTexts = p.options.map(opt => opt.substring(3).trim());
                        
                        for (let i = answerTexts.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [answerTexts[i], answerTexts[j]] = [answerTexts[j], answerTexts[i]];
                        }
                        
                        p.options = answerTexts.map((text, index) => labels[index] + text);
                        const newCorrectIndex = answerTexts.findIndex(text => text === correctAnswerText);
                        
                        if (newCorrectIndex !== -1) {
                           p.correct = newCorrectIndex;
                        }
                    }
                });

                shuffleArray(preguntas);
                preguntas = preguntas.map(p => ({
                    ...p,
                    respuestaUsuario: null,
                    comprobada: false,
                    esCorrecta: false
                }));

                const fragmentoOpciones = document.createDocumentFragment();
                for (let i = 0; i < 4; i++) {
                    const boton = document.createElement('button');
                    boton.className = 'opcion';
                    boton.dataset.index = i;
                    fragmentoOpciones.appendChild(boton);
                }
                DOM.opcionesContenedor.appendChild(fragmentoOpciones);

                botonesOpciones = Array.from(DOM.opcionesContenedor.querySelectorAll('.opcion'));

                crearIndices();
            }

            function setupEvents() {
                DOM.contenedorTest.addEventListener('click', (event) => {
                    const target = event.target;
                    if (target.id === 'siguiente-btn') {
                        siguientePregunta();
                    } else if (target.id === 'volver-btn') {
                        volverPregunta();
                    } else if (target.id === 'comprobar-btn') {
                        comprobarRespuesta();
                    } else if (target.classList.contains('opcion')) {
                        manejarSeleccion(event);
                    }
                });

                DOM.rectanguloResumen.addEventListener('click', (event) => {
                    const target = event.target;
                    if (target.id === 'finalizar-btn') {
                        toggleFinalizarTest();
                    } else if (target.classList.contains('indice-pregunta')) {
                        manejarClickIndice(event);
                    }
                });

                DOM.modalOkBtn.addEventListener('click', ocultarModal);
                DOM.volverMenuBtn.addEventListener('click', volverAlMenuPrincipal);
            }

            function init() {
                DOM = cacheElements();
                initData();
                setupEvents();
                mostrarPregunta();
            }

            init();
        });
    </script>
</body>
</html>